

<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      index.js - Documentation
  </title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  

  
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li >
        <a href="index.html">
          
            <svg fill="#6D6D6D" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      SDK Client Reference
    </h3>

    

    <h3>Classes</h3><ul><li id="StreamduckClient-nav"><a href="StreamduckClient.html">StreamduckClient</a><ul class='methods'><li data-type="method" id="StreamduckClient-add_component-nav"><a href="StreamduckClient.html#add_component">add_component</a></li><li data-type="method" id="StreamduckClient-add_component-nav"><a href="StreamduckClient.html#add_component">add_component</a></li><li data-type="method" id="StreamduckClient-add_component_value-nav"><a href="StreamduckClient.html#add_component_value">add_component_value</a></li><li data-type="method" id="StreamduckClient-add_component_value-nav"><a href="StreamduckClient.html#add_component_value">add_component_value</a></li><li data-type="method" id="StreamduckClient-add_device-nav"><a href="StreamduckClient.html#add_device">add_device</a></li><li data-type="method" id="StreamduckClient-add_device-nav"><a href="StreamduckClient.html#add_device">add_device</a></li><li data-type="method" id="StreamduckClient-add_event_listener-nav"><a href="StreamduckClient.html#add_event_listener">add_event_listener</a></li><li data-type="method" id="StreamduckClient-add_event_listener-nav"><a href="StreamduckClient.html#add_event_listener">add_event_listener</a></li><li data-type="method" id="StreamduckClient-add_image-nav"><a href="StreamduckClient.html#add_image">add_image</a></li><li data-type="method" id="StreamduckClient-add_image-nav"><a href="StreamduckClient.html#add_image">add_image</a></li><li data-type="method" id="StreamduckClient-add_module_value-nav"><a href="StreamduckClient.html#add_module_value">add_module_value</a></li><li data-type="method" id="StreamduckClient-add_module_value-nav"><a href="StreamduckClient.html#add_module_value">add_module_value</a></li><li data-type="method" id="StreamduckClient-clear_button-nav"><a href="StreamduckClient.html#clear_button">clear_button</a></li><li data-type="method" id="StreamduckClient-clear_button-nav"><a href="StreamduckClient.html#clear_button">clear_button</a></li><li data-type="method" id="StreamduckClient-clipboard_status-nav"><a href="StreamduckClient.html#clipboard_status">clipboard_status</a></li><li data-type="method" id="StreamduckClient-clipboard_status-nav"><a href="StreamduckClient.html#clipboard_status">clipboard_status</a></li><li data-type="method" id="StreamduckClient-commit_changes-nav"><a href="StreamduckClient.html#commit_changes">commit_changes</a></li><li data-type="method" id="StreamduckClient-commit_changes-nav"><a href="StreamduckClient.html#commit_changes">commit_changes</a></li><li data-type="method" id="StreamduckClient-copy_button-nav"><a href="StreamduckClient.html#copy_button">copy_button</a></li><li data-type="method" id="StreamduckClient-copy_button-nav"><a href="StreamduckClient.html#copy_button">copy_button</a></li><li data-type="method" id="StreamduckClient-destroy-nav"><a href="StreamduckClient.html#destroy">destroy</a></li><li data-type="method" id="StreamduckClient-destroy-nav"><a href="StreamduckClient.html#destroy">destroy</a></li><li data-type="method" id="StreamduckClient-device_list-nav"><a href="StreamduckClient.html#device_list">device_list</a></li><li data-type="method" id="StreamduckClient-device_list-nav"><a href="StreamduckClient.html#device_list">device_list</a></li><li data-type="method" id="StreamduckClient-do_button_action-nav"><a href="StreamduckClient.html#do_button_action">do_button_action</a></li><li data-type="method" id="StreamduckClient-do_button_action-nav"><a href="StreamduckClient.html#do_button_action">do_button_action</a></li><li data-type="method" id="StreamduckClient-drop_stack_to_root-nav"><a href="StreamduckClient.html#drop_stack_to_root">drop_stack_to_root</a></li><li data-type="method" id="StreamduckClient-drop_stack_to_root-nav"><a href="StreamduckClient.html#drop_stack_to_root">drop_stack_to_root</a></li><li data-type="method" id="StreamduckClient-export_device_config-nav"><a href="StreamduckClient.html#export_device_config">export_device_config</a></li><li data-type="method" id="StreamduckClient-export_device_config-nav"><a href="StreamduckClient.html#export_device_config">export_device_config</a></li><li data-type="method" id="StreamduckClient-force_pop_screen-nav"><a href="StreamduckClient.html#force_pop_screen">force_pop_screen</a></li><li data-type="method" id="StreamduckClient-force_pop_screen-nav"><a href="StreamduckClient.html#force_pop_screen">force_pop_screen</a></li><li data-type="method" id="StreamduckClient-get_brightness-nav"><a href="StreamduckClient.html#get_brightness">get_brightness</a></li><li data-type="method" id="StreamduckClient-get_brightness-nav"><a href="StreamduckClient.html#get_brightness">get_brightness</a></li><li data-type="method" id="StreamduckClient-get_button-nav"><a href="StreamduckClient.html#get_button">get_button</a></li><li data-type="method" id="StreamduckClient-get_button-nav"><a href="StreamduckClient.html#get_button">get_button</a></li><li data-type="method" id="StreamduckClient-get_button_image-nav"><a href="StreamduckClient.html#get_button_image">get_button_image</a></li><li data-type="method" id="StreamduckClient-get_button_image-nav"><a href="StreamduckClient.html#get_button_image">get_button_image</a></li><li data-type="method" id="StreamduckClient-get_button_images-nav"><a href="StreamduckClient.html#get_button_images">get_button_images</a></li><li data-type="method" id="StreamduckClient-get_button_images-nav"><a href="StreamduckClient.html#get_button_images">get_button_images</a></li><li data-type="method" id="StreamduckClient-get_component_values-nav"><a href="StreamduckClient.html#get_component_values">get_component_values</a></li><li data-type="method" id="StreamduckClient-get_component_values-nav"><a href="StreamduckClient.html#get_component_values">get_component_values</a></li><li data-type="method" id="StreamduckClient-get_current_screen-nav"><a href="StreamduckClient.html#get_current_screen">get_current_screen</a></li><li data-type="method" id="StreamduckClient-get_current_screen-nav"><a href="StreamduckClient.html#get_current_screen">get_current_screen</a></li><li data-type="method" id="StreamduckClient-get_device-nav"><a href="StreamduckClient.html#get_device">get_device</a></li><li data-type="method" id="StreamduckClient-get_device-nav"><a href="StreamduckClient.html#get_device">get_device</a></li><li data-type="method" id="StreamduckClient-get_device_config-nav"><a href="StreamduckClient.html#get_device_config">get_device_config</a></li><li data-type="method" id="StreamduckClient-get_device_config-nav"><a href="StreamduckClient.html#get_device_config">get_device_config</a></li><li data-type="method" id="StreamduckClient-get_module_values-nav"><a href="StreamduckClient.html#get_module_values">get_module_values</a></li><li data-type="method" id="StreamduckClient-get_module_values-nav"><a href="StreamduckClient.html#get_module_values">get_module_values</a></li><li data-type="method" id="StreamduckClient-get_stack-nav"><a href="StreamduckClient.html#get_stack">get_stack</a></li><li data-type="method" id="StreamduckClient-get_stack-nav"><a href="StreamduckClient.html#get_stack">get_stack</a></li><li data-type="method" id="StreamduckClient-get_stack_names-nav"><a href="StreamduckClient.html#get_stack_names">get_stack_names</a></li><li data-type="method" id="StreamduckClient-get_stack_names-nav"><a href="StreamduckClient.html#get_stack_names">get_stack_names</a></li><li data-type="method" id="StreamduckClient-import_device_config-nav"><a href="StreamduckClient.html#import_device_config">import_device_config</a></li><li data-type="method" id="StreamduckClient-import_device_config-nav"><a href="StreamduckClient.html#import_device_config">import_device_config</a></li><li data-type="method" id="StreamduckClient-is_connected-nav"><a href="StreamduckClient.html#is_connected">is_connected</a></li><li data-type="method" id="StreamduckClient-is_connected-nav"><a href="StreamduckClient.html#is_connected">is_connected</a></li><li data-type="method" id="StreamduckClient-list_components-nav"><a href="StreamduckClient.html#list_components">list_components</a></li><li data-type="method" id="StreamduckClient-list_components-nav"><a href="StreamduckClient.html#list_components">list_components</a></li><li data-type="method" id="StreamduckClient-list_fonts-nav"><a href="StreamduckClient.html#list_fonts">list_fonts</a></li><li data-type="method" id="StreamduckClient-list_fonts-nav"><a href="StreamduckClient.html#list_fonts">list_fonts</a></li><li data-type="method" id="StreamduckClient-list_images-nav"><a href="StreamduckClient.html#list_images">list_images</a></li><li data-type="method" id="StreamduckClient-list_images-nav"><a href="StreamduckClient.html#list_images">list_images</a></li><li data-type="method" id="StreamduckClient-list_modules-nav"><a href="StreamduckClient.html#list_modules">list_modules</a></li><li data-type="method" id="StreamduckClient-list_modules-nav"><a href="StreamduckClient.html#list_modules">list_modules</a></li><li data-type="method" id="StreamduckClient-new_button-nav"><a href="StreamduckClient.html#new_button">new_button</a></li><li data-type="method" id="StreamduckClient-new_button-nav"><a href="StreamduckClient.html#new_button">new_button</a></li><li data-type="method" id="StreamduckClient-new_button_from_component-nav"><a href="StreamduckClient.html#new_button_from_component">new_button_from_component</a></li><li data-type="method" id="StreamduckClient-new_button_from_component-nav"><a href="StreamduckClient.html#new_button_from_component">new_button_from_component</a></li><li data-type="method" id="StreamduckClient-paste_button-nav"><a href="StreamduckClient.html#paste_button">paste_button</a></li><li data-type="method" id="StreamduckClient-paste_button-nav"><a href="StreamduckClient.html#paste_button">paste_button</a></li><li data-type="method" id="StreamduckClient-pop_screen-nav"><a href="StreamduckClient.html#pop_screen">pop_screen</a></li><li data-type="method" id="StreamduckClient-pop_screen-nav"><a href="StreamduckClient.html#pop_screen">pop_screen</a></li><li data-type="method" id="StreamduckClient-push_screen-nav"><a href="StreamduckClient.html#push_screen">push_screen</a></li><li data-type="method" id="StreamduckClient-push_screen-nav"><a href="StreamduckClient.html#push_screen">push_screen</a></li><li data-type="method" id="StreamduckClient-reload_device_config-nav"><a href="StreamduckClient.html#reload_device_config">reload_device_config</a></li><li data-type="method" id="StreamduckClient-reload_device_config-nav"><a href="StreamduckClient.html#reload_device_config">reload_device_config</a></li><li data-type="method" id="StreamduckClient-reload_device_configs-nav"><a href="StreamduckClient.html#reload_device_configs">reload_device_configs</a></li><li data-type="method" id="StreamduckClient-reload_device_configs-nav"><a href="StreamduckClient.html#reload_device_configs">reload_device_configs</a></li><li data-type="method" id="StreamduckClient-remove_component-nav"><a href="StreamduckClient.html#remove_component">remove_component</a></li><li data-type="method" id="StreamduckClient-remove_component-nav"><a href="StreamduckClient.html#remove_component">remove_component</a></li><li data-type="method" id="StreamduckClient-remove_component_value-nav"><a href="StreamduckClient.html#remove_component_value">remove_component_value</a></li><li data-type="method" id="StreamduckClient-remove_component_value-nav"><a href="StreamduckClient.html#remove_component_value">remove_component_value</a></li><li data-type="method" id="StreamduckClient-remove_device-nav"><a href="StreamduckClient.html#remove_device">remove_device</a></li><li data-type="method" id="StreamduckClient-remove_device-nav"><a href="StreamduckClient.html#remove_device">remove_device</a></li><li data-type="method" id="StreamduckClient-remove_image-nav"><a href="StreamduckClient.html#remove_image">remove_image</a></li><li data-type="method" id="StreamduckClient-remove_image-nav"><a href="StreamduckClient.html#remove_image">remove_image</a></li><li data-type="method" id="StreamduckClient-remove_module_value-nav"><a href="StreamduckClient.html#remove_module_value">remove_module_value</a></li><li data-type="method" id="StreamduckClient-remove_module_value-nav"><a href="StreamduckClient.html#remove_module_value">remove_module_value</a></li><li data-type="method" id="StreamduckClient-replace_screen-nav"><a href="StreamduckClient.html#replace_screen">replace_screen</a></li><li data-type="method" id="StreamduckClient-replace_screen-nav"><a href="StreamduckClient.html#replace_screen">replace_screen</a></li><li data-type="method" id="StreamduckClient-reset_stack-nav"><a href="StreamduckClient.html#reset_stack">reset_stack</a></li><li data-type="method" id="StreamduckClient-reset_stack-nav"><a href="StreamduckClient.html#reset_stack">reset_stack</a></li><li data-type="method" id="StreamduckClient-save_device_config-nav"><a href="StreamduckClient.html#save_device_config">save_device_config</a></li><li data-type="method" id="StreamduckClient-save_device_config-nav"><a href="StreamduckClient.html#save_device_config">save_device_config</a></li><li data-type="method" id="StreamduckClient-save_device_configs-nav"><a href="StreamduckClient.html#save_device_configs">save_device_configs</a></li><li data-type="method" id="StreamduckClient-save_device_configs-nav"><a href="StreamduckClient.html#save_device_configs">save_device_configs</a></li><li data-type="method" id="StreamduckClient-set_brightness-nav"><a href="StreamduckClient.html#set_brightness">set_brightness</a></li><li data-type="method" id="StreamduckClient-set_brightness-nav"><a href="StreamduckClient.html#set_brightness">set_brightness</a></li><li data-type="method" id="StreamduckClient-set_button-nav"><a href="StreamduckClient.html#set_button">set_button</a></li><li data-type="method" id="StreamduckClient-set_button-nav"><a href="StreamduckClient.html#set_button">set_button</a></li><li data-type="method" id="StreamduckClient-set_component_value-nav"><a href="StreamduckClient.html#set_component_value">set_component_value</a></li><li data-type="method" id="StreamduckClient-set_component_value-nav"><a href="StreamduckClient.html#set_component_value">set_component_value</a></li><li data-type="method" id="StreamduckClient-set_module_value-nav"><a href="StreamduckClient.html#set_module_value">set_module_value</a></li><li data-type="method" id="StreamduckClient-set_module_value-nav"><a href="StreamduckClient.html#set_module_value">set_module_value</a></li><li data-type="method" id="StreamduckClient-version-nav"><a href="StreamduckClient.html#version">version</a></li><li data-type="method" id="StreamduckClient-version-nav"><a href="StreamduckClient.html#version">version</a></li></ul></li></ul><h3 id="global-nav">Global</h3><ul><li><a href="global.html#newUnixClient">newUnixClient</a></li><li><a href="global.html#newWindowsClient">newWindowsClient</a></li></ul>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        index.js
      </h1>
    

    
      

<section>
  <article>
    <pre class="prettyprint source linenums"><code>const net = require('net'),
	randomstring = require('randomstring');

// noinspection JSUnusedGlobalSymbols
/**
 * Client class that contains methods for communicating with Streamduck daemon
 */
class StreamduckClient {
	constructor(protocol) {
		this.protocol = protocol;
	}

	/**
	 * Button object
	 * @typedef {Object.&lt;string, any>} Button
	 */

	/**
	 * Value object
	 * @typedef {{name: string, display_name: string, description: string, path: string, ty: any, value: any}} Value
	 */

	/**
	 * Panel object
	 * @typedef {{display_name: string, data: any, buttons: Object.&lt;string, Button>}} Panel
	 */

	/**
	 * Device Config object
	 * @typedef {{vid: number, pid: number, serial: string, brightness: number, layout: Panel, images: Object.&lt;string, string>, plugin_data: Object.&lt;string, any>}} DeviceConfig
	 */


	/**
	 * Event listener
	 * @callback EventListener
	 * @param {Object} event Event data
	 */

	/**
	 * Adds event listener
	 * @param {EventListener} listener Listener to add
	 */
	add_event_listener(listener) {
		this.protocol.add_event_listener(listener)
	}

	/**
	 * Checks if protocol is currently connected to daemon
	 * @returns {boolean} Connection status
	 */
	is_connected() {
		return this.protocol.connected()
	}

	/**
	 * Retrieves version of socket API that daemon is using
	 * @returns {Promise&lt;string>} Version of the daemon
	 */
	version() {
		return this.protocol.request(
			{
				ty: "socket_version"
			}
		).then(data => data.version);
	}

	/**
	 * Retrieves device list currently recognized by daemon
	 * @returns {Promise&lt;Array.&lt;{device_type: ("Unknown"|"Mini"|"Original"|"OriginalV2"|"XL"|"MK2"), serial_number: string, managed: boolean, online: boolean}>>} Device list
	 */
	device_list() {
		return this.protocol.request(
			{
				ty: "list_devices"
			}
		).then(data => data.devices)
	}

	/**
	 * Retrieves data of specific device
	 * @param {string} serial_number Serial number of the device
	 * @returns {Promise&lt;?{device_type: ("Unknown"|"Mini"|"Original"|"OriginalV2"|"XL"|"MK2"), serial_number: string, managed: boolean, online: boolean}>} Device Data, null if device wasn't found
	 */
	get_device(serial_number) {
		return this.protocol.request(
			{
				ty: "get_device",
				data: {
					serial_number
				}
			}
		).then(data => {
			if (data.Found) {
				return data.Found;
			} else {
				return null;
			}
		})
	}

	/**
	 * Adds device into managed list
	 * @param {string} serial_number Serial number of the device
	 * @returns {Promise&lt;"NotFound"|"AlreadyRegistered"|"Added">} Result of the operation 
	 */
	add_device(serial_number) {
		return this.protocol.request(
			{
				ty: "add_device",
				data: {
					serial_number
				}
			}
		)
	}

	/**
	 * Removes device from managed list
	 * @param {string} serial_number Serial number of the device
	 * @returns {Promise&lt;"NotRegistered"|"Removed">} Result of the operation 
	 */
	remove_device(serial_number) {
		return this.protocol.request(
			{
				ty: "remove_device",
				data: {
					serial_number
				}
			}
		)
	}

	/**
	 * Reloads all device configs, all unsaved changes will be lost doing this
	 * @returns {Promise&lt;"ConfigError"|"Reloaded">} Result of the operation 
	 */
	reload_device_configs() {
		return this.protocol.request(
			{
				ty: "reload_device_configs",
			}
		)
	}

	/**
	 * Reloads device config of specified device, all unsaved changes will be lost doing this
	 * @param {string} serial_number Serial number of the device
	 * @returns {Promise&lt;"ConfigError"|"DeviceNotFound"|"Reloaded">} Result of the operation 
	 */
	reload_device_config(serial_number) {
		return this.protocol.request(
			{
				ty: "reload_device_config",
				data: {
					serial_number
				}
			}
		)
	}

	/**
	 * Saves all device configs
	 * @returns {Promise&lt;"ConfigError"|"Saved">} Result of the operation
	 */
	save_device_configs() {
		return this.protocol.request(
			{
				ty: "save_device_configs",
			}
		)
	}

	/**
	 * Saves device config of specified device
	 * @param {string} serial_number Serial number of the device
	 * @returns {Promise&lt;"ConfigError"|"DeviceNotFound"|"Saved">} Return of the operation
	 */
	save_device_config(serial_number) {
		return this.protocol.request(
			{
				ty: "save_device_config",
				data: {
					serial_number
				}
			}
		)
	}

	/**
	 * Gets device config of specified device
	 * @param {string} serial_number Serial number of the device
	 * @returns {Promise&lt;?DeviceConfig>} Device config, null if device wasn't found
	 */
	get_device_config(serial_number) {
		return this.protocol.request(
			{
				ty: "get_device_config",
				data: {
					serial_number
				}
			}
		).then(data => {
			if (data.Config) {
				return data.Config;
			} else {
				return null;
			}
		})
	}

	/**
	 * Exports device config from daemon
	 * @param {string} serial_number Serial number of the device
	 * @returns {Promise&lt;?string>} String that represents device config, null if device wasn't found
	 */
	export_device_config(serial_number) {
		return this.protocol.request(
			{
				ty: "export_device_config",
				data: {
					serial_number
				}
			}
		).then(data => {
			if (data.Exported) {
				return data.Exported;
			} else {
				return null;
			}
		})
	}


	/**
	 * Imports device config from string into daemon
	 * @param {string} serial_number Serial number of the device
	 * @param {string} config String that represents device config
	 * @returns {Promise&lt;"DeviceNotFound"|"InvalidConfig"|"FailedToSave"|"Imported">} Result of the operation. "FailedToSave" if error happened while saving config on daemon's end
	 */
	import_device_config(serial_number, config) {
		return this.protocol.request(
			{
				ty: "import_device_config",
				data: {
					serial_number,
					config
				}
			}
		)
	}

	/**
	 * Gets current brightness of specified device
	 * @param {string} serial_number Serial number of the device
	 * @returns {Promise&lt;?number>} Brightness value, or null if device wasn't found
	 */
	get_brightness(serial_number) {
		return this.protocol.request(
			{
				ty: "get_brightness",
				data: {
					serial_number
				}
			}
		).then(data => {
			if (data.Brightness) {
				return data.Brightness;
			} else {
				return null;
			}
		})
	}

	/**
	 * Sets brightness of specified device
	 * @param {string} serial_number Serial number of the device
	 * @param {number|string} brightness Brightness value (integer 0-100 or higher)
	 * @returns {Promise&lt;"DeviceNotFound"|"Set">} Result of the operation 
	 */
	set_brightness(serial_number, brightness) {
		return this.protocol.request(
			{
				ty: "set_brightness",
				data: {
					serial_number,
					brightness: parseInt(brightness)
				}
			}
		)
	}

	/**
	 * Lists images of specified device
	 * @param {string} serial_number Serial number of the device
	 * @returns {Promise&lt;?Object.&lt;string, string>>} Image map, null if device wasn't found
	 */
	list_images(serial_number) {
		return this.protocol.request(
			{
				ty: "list_images",
				data: {
					serial_number
				}
			}
		).then(data => {
			if (data.Images) {
				return data.Images;
			} else {
				return null;
			}
		})
	}

	/**
	 * Adds images of specified device
	 * @param {string} serial_number Serial number of the device
	 * @param {string} image_data Image encoded in Base64
	 * @returns {Promise&lt;?string>} Image identifier, null if invalid image or device wasn't found
	 */
	add_image(serial_number, image_data) {
		return this.protocol.request(
			{
				ty: "add_image",
				data: {
					serial_number,
					image_data
				}
			},
			8640000000
		).then(data => {
			if (data.Added) {
				return data.Added;
			} else {
				return null;
			}
		})
	}

	/**
	 * Removes images from specified device
	 * @param {string} serial_number Serial number of the device
	 * @param {string} image_identifier Image identifier
	 * @returns {Promise&lt;"NotFound"|"Removed">} Result of the operation
	 */
	remove_image(serial_number, image_identifier) {
		return this.protocol.request(
			{
				ty: "remove_image",
				data: {
					serial_number,
					image_identifier
				}
			}
		)
	}

	/**
	 * Lists names of fonts loaded by daemon
	 * @returns {Promise&lt;Array.&lt;string>>} Font name list
	 */
	list_fonts() {
		return this.protocol.request(
			{
				ty: "list_fonts"
			}
		).then(data => data.font_names)
	}

	/**
	 * Lists modules daemon has loaded
	 * @returns {Promise&lt;Array.&lt;{name: string, author: string, description: string, version: string, used_features: Array.&lt;Array.&lt;string>>}>>} Module list 
	 */
	list_modules() {
		return this.protocol.request(
			{
				ty: "list_modules"
			}
		).then(data => data.modules)
	}

	/**
	 * Lists components provided by loaded modules
	 * @returns {Promise&lt;Object.&lt;string, Object.&lt;string, {default_looks: Object, description: string, display_name: string}>>>} Map of modules to maps of component names to component definitions
	 */
	list_components() {
		return this.protocol.request(
			{
				ty: "list_components"
			}
		).then(data => data.components)
	}

	/**
	 * Retrieves module values of specified module
	 * @param {string} module_name Module name
	 * @returns {Promise&lt;?Array.&lt;Value>>} Module values, null if module wasn't found
	 */
	get_module_values(module_name) {
		return this.protocol.request(
			{
				ty: "get_module_values",
				data: {
					module_name
				}
			}
		).then(data => {
			if (data.Values) {
				return data.Values;
			} else {
				return null;
			}
		})
	}

	/**
	 * Adds element to module setting for specified module
	 * @param {string} module_name Module name
	 * @param {string} path Path to setting
	 * @returns {Promise&lt;"ModuleNotFound"|"FailedToAdd"|"Added">} Result of the operation
	 */
	add_module_value(module_name, path) {
		return this.protocol.request(
			{
				ty: "add_module_value",
				data: {
					module_name,
					path
				}
			}
		)
	}

	/**
	 * Removes element from module setting for specified module
	 * @param {string} module_name Module name
	 * @param {string} path Path to setting
	 * @param {number|string} index Index of element
	 * @returns {Promise&lt;"ModuleNotFound"|"FailedToRemove"|"Removed">} Result of the operation
	 */
	remove_module_value(module_name, path, index) {
		return this.protocol.request(
			{
				ty: "remove_module_value",
				data: {
					module_name,
					path,
					index: parseInt(index)
				}
			}
		)
	}

	/**
	 * Sets module values for specified module
	 * @param {string} module_name Module name
	 * @param {Value} value Value to set
	 * @returns {Promise&lt;"ModuleNotFound"|"FailedToSet"|"Set">} Result of the operation
	 */
	set_module_value(module_name, value) {
		return this.protocol.request(
			{
				ty: "set_module_value",
				data: {
					module_name,
					value
				}
			},
			8640000000
		)
	}

	/**
	 * Gets screen stack of specified device
	 * @param {string} serial_number Serial number of the device
	 * @returns {Promise&lt;?Array.&lt;Panel>>} Screen stack array, null if device wasn't found
	 */
	get_stack(serial_number) {
		return this.protocol.request(
			{
				ty: "get_stack",
				data: {
					serial_number
				}
			}
		).then(data => {
			if (data.Stack) {
				return data.Stack;
			} else {
				return null;
			}
		})
	}

	/**
	 * Gets screen stack names of specified device
	 * @param {string} serial_number Serial number of the device
	 * @returns {Promise&lt;?Array.&lt;string>>} Screen stack name array, null if device wasn't found
	 */
	get_stack_names(serial_number) {
		return this.protocol.request(
			{
				ty: "get_stack_names",
				data: {
					serial_number
				}
			}
		).then(data => {
			if (data.Stack) {
				return data.Stack;
			} else {
				return null;
			}
		})
	}

	/**
	 * Gets current screen of specified device
	 * @param {string} serial_number Serial number of the device
	 * @returns {Promise&lt;?Panel>} Screen consisting of key indices and button objects, null if device wasn't found
	 */
	get_current_screen(serial_number) {
		return this.protocol.request(
			{
				ty: "get_current_screen",
				data: {
					serial_number
				}
			}
		).then(data => {
			if (data.Screen) {
				return data.Screen;
			} else {
				return null;
			}
		})
	}

	/**
	 * Gets current image rendered on specified device
	 * @param {string} serial_number Serial number of the device
	 * @param {number|string} key Index of the key (0-255)
	 * @returns {Promise&lt;?string>} Base64 png image data, null if device or button wasn't found
	 */
	get_button_image(serial_number, key) {
		return this.protocol.request(
			{
				ty: "get_button_image",
				data: {
					serial_number,
					key: parseInt(key)
				}
			}
		).then(data => {
			if (data.Image) {
				return data.Image;
			} else {
				return null;
			}
		})
	}

	/**
	 * Gets current images rendered on specified device
	 * @param {string} serial_number Serial number of the device
	 * @returns {Promise&lt;?Object.&lt;string, string>>} Map consisting of key indices and base64 png image data, null if device wasn't found
	 */
	get_button_images(serial_number) {
		return this.protocol.request(
			{
				ty: "get_button_images",
				data: {
					serial_number
				}
			}
		).then(data => {
			if (data.Images) {
				return data.Images;
			} else {
				return null;
			}
		})
	}

	/**
	 * Retrieves button from current screen of specified device
	 * @param {string} serial_number Serial number of the device
	 * @param {number|string} key Index of the key (0-255)
	 * @returns {Promise&lt;?Button>} Button object, null if device or button wasn't found
	 */
	get_button(serial_number, key) {
		return this.protocol.request(
			{
				ty: "get_button",
				data: {
					serial_number,
					key: parseInt(key)
				}
			}
		).then(data => {
			if (data.Button) {
				return data.Button;
			} else {
				return null;
			}
		})
	}

	/**
	 * Sets button on current screen for specified device, commit the change later with commit_changes in order for this to get saved
	 * @param {string} serial_number Serial number of the device
	 * @param {number|string} key Index of the key (0-255)
	 * @param {Button} button Button object
	 * @returns {Promise&lt;"NoScreen"|"DeviceNotFound"|"Set">} Result of the operation
	 */
	set_button(serial_number, key, button) {
		return this.protocol.request(
			{
				ty: "set_button",
				data: {
					serial_number,
					key: parseInt(key),
					button
				}
			}
		)
	}

	/**
	 * Clears button from current screen for specified device, commit the change later with commit_changes in order for this to get saved
	 * @param {string} serial_number Serial number of the device
	 * @param {number|string} key Index of the key (0-255)
	 * @returns {Promise&lt;"DeviceNotFound"|"FailedToClear"|"Cleared">} Result of the operation
	 */
	clear_button(serial_number, key) {
		return this.protocol.request(
			{
				ty: "clear_button",
				data: {
					serial_number,
					key: parseInt(key)
				}
			}
		)
	}

	/**
	 * Retrieves clipboard status of daemon
	 * @returns {Promise&lt;"Empty"|"Full">} Clipboard status, it's either empty or full
	 */
	clipboard_status() {
		return this.protocol.request(
			{
				ty: "clipboard_status"
			}
		)
	}

	/**
	 * Copies button into daemon's clipboard
	 * @param {string} serial_number Serial number of the device
	 * @param {number|string} key Index of the key (0-255)
	 * @returns {Promise&lt;"DeviceNotFound"|"NoButton"|"Copied">} Result of the operation
	 */
	copy_button(serial_number, key) {
		return this.protocol.request(
			{
				ty: "copy_button",
				data: {
					serial_number,
					key: parseInt(key)
				}
			}
		)
	}

	/**
	 * Pastes button from daemon's clipboard
	 * @param {string} serial_number Serial number of the device
	 * @param {number|string} key Index of the key (0-255)
	 * @returns {Promise&lt;"DeviceNotFound"|"FailedToPaste"|"Pasted">} Result of the operation
	 */
	paste_button(serial_number, key) {
		return this.protocol.request(
			{
				ty: "paste_button",
				data: {
					serial_number,
					key: parseInt(key)
				}
			}
		)
	}

	/**
	 * Creates a new empty button, commit the change later with commit_changes in order for this to get saved
	 * @param {string} serial_number Serial number of the device
	 * @param {number|string} key Index of the key (0-255)
	 * @returns {Promise&lt;"DeviceNotFound"|"FailedToCreate"|"Created">} Result of the operation
	 */
	new_button(serial_number, key) {
		return this.protocol.request(
			{
				ty: "new_button",
				data: {
					serial_number,
					key: parseInt(key)
				}
			}
		)
	}

	/**
	 * Creates a new button from component, commit the change later with commit_changes in order for this to get saved
	 * @param {string} serial_number Serial number of the device
	 * @param {number|string} key Index of the key (0-255)
	 * @param {string} component_name Component name
	 * @returns {Promise&lt;"DeviceNotFound"|"ComponentNotFound"|"FailedToCreate"|"Created">} Result of the operation
	 */
	new_button_from_component(serial_number, key, component_name) {
		return this.protocol.request(
			{
				ty: "new_button_from_component",
				data: {
					serial_number,
					key: parseInt(key),
					component_name
				}
			}
		)
	}

	/**
	 * Adds component onto a button, commit the change later with commit_changes in order for this to get saved
	 * @param {string} serial_number Serial number of the device
	 * @param {number|string} key Index of the key (0-255)
	 * @param {string} component_name Component name
	 * @returns {Promise&lt;"DeviceNotFound"|"FailedToAdd"|"Added">} Result of the operation
	 */
	add_component(serial_number, key, component_name) {
		return this.protocol.request(
			{
				ty: "add_component",
				data: {
					serial_number,
					key: parseInt(key),
					component_name
				}
			}
		)
	}

	/**
	 * Gets component values for component from a button
	 * @param {string} serial_number Serial number of the device
	 * @param {number|string} key Index of the key (0-255)
	 * @param {string} component_name Component name
	 * @returns {Promise&lt;?Array.&lt;Value>>} Component values, null if component or device wasn't found
	 */
	get_component_values(serial_number, key, component_name) {
		return this.protocol.request(
			{
				ty: "get_component_values",
				data: {
					serial_number,
					key: parseInt(key),
					component_name
				}
			}
		).then(data => {
			if (data.Values) {
				return data.Values;
			} else {
				return null;
			}
		})
	}

	/**
	 * Adds element to component value, commit the change later with commit_changes in order for this to get saved
	 * @param {string} serial_number Serial number of the device
	 * @param {number|string} key Index of the key (0-255)
	 * @param {string} component_name Component name
	 * @param {string} path Path to value
	 * @returns {Promise&lt;"DeviceNotFound"|"FailedToAdd"|"Added">} Result of the operation
	 */
	add_component_value(serial_number, key, component_name, path) {
		return this.protocol.request(
			{
				ty: "add_component_value",
				data: {
					serial_number,
					key: parseInt(key),
					component_name,
					path
				}
			}
		)
	}

	/**
	 * Removes element from component value, commit the change later with commit_changes in order for this to get saved
	 * @param {string} serial_number Serial number of the device
	 * @param {number|string} key Index of the key (0-255)
	 * @param {string} component_name Component name
	 * @param {string} path Path to value
	 * @param {number|string} index Index of element
	 * @returns {Promise&lt;"DeviceNotFound"|"FailedToRemove"|"Removed">} Result of the operation
	 */
	remove_component_value(serial_number, key, component_name, path, index) {
		return this.protocol.request(
			{
				ty: "remove_component_value",
				data: {
					serial_number,
					key: parseInt(key),
					component_name,
					path,
					index: parseInt(index)
				}
			}
		)
	}

	/**
	 * Sets component values for a component on a button, commit the change later with commit_changes in order for this to get saved
	 * @param {string} serial_number Serial number of the device
	 * @param {number|string} key Index of the key (0-255)
	 * @param {string} component_name Component name
	 * @param {Value} value Value to set
	 * @returns {Promise&lt;"DeviceNotFound"|"FailedToSet"|"Set">} Result of the operation
	 */
	set_component_value(serial_number, key, component_name, value) {
		return this.protocol.request(
			{
				ty: "set_component_value",
				data: {
					serial_number,
					key: parseInt(key),
					component_name,
					value
				}
			},
			8640000000
		)
	}

	/**
	 * Removes component from a button, commit the change later with commit_changes in order for this to get saved
	 * @param {string} serial_number Serial number of the device
	 * @param {number|string} key Index of the key (0-255)
	 * @param {string} component_name Component name 
	 * @returns {Promise&lt;"DeviceNotFound"|"FailedToRemove"|"Removed">} Result of the operation
	 */
	remove_component(serial_number, key, component_name) {
		return this.protocol.request(
			{
				ty: "remove_component",
				data: {
					serial_number,
					key: parseInt(key),
					component_name
				}
			}
		)
	}

	/**
	 * Pushes a new screen into device's screen stack
	 * @param {string} serial_number Serial number of the device
	 * @param {Panel} screen Screen object consisting of key indices and button objects
	 * @returns {Promise&lt;"DeviceNotFound"|"Pushed">} Result of the operation
	 */
	push_screen(serial_number, screen) {
		return this.protocol.request(
			{
				ty: "push_screen",
				data: {
					serial_number,
					screen
				}
			}
		)
	}

	/**
	 * Pops a screen from device's screen stack, unless only one screen remaining
	 * @param {string} serial_number Serial number of the device
	 * @returns {Promise&lt;"DeviceNotFound"|"OnlyOneRemaining"|"Popped">} Result of the operation
	 */
	pop_screen(serial_number) {
		return this.protocol.request(
			{
				ty: "pop_screen",
				data: {
					serial_number
				}
			}
		)
	}

	/**
	 * Pops a screen from device's screen stack, bypassing limit of pop_screen, use this only if you know what you're doing
	 * @param {string} serial_number Serial number of the device
	 * @returns {Promise&lt;"DeviceNotFound"|"Popped">} Result of the operation
	 */
	force_pop_screen(serial_number) {
		return this.protocol.request(
			{
				ty: "force_pop_screen",
				data: {
					serial_number
				}
			}
		)
	}

	/**
	 * Replaces current screen with new one
	 * @param {string} serial_number Serial number of the device
	 * @param {Panel} screen Screen object consisting of key indices and button objects
	 * @returns {Promise&lt;"DeviceNotFound"|"Replaced">} Result of the operation
	 */
	replace_screen(serial_number, screen) {
		return this.protocol.request(
			{
				ty: "replace_screen",
				data: {
					serial_number,
					screen
				}
			}
		)
	}

	/**
	 * Resets stack and pushes a screen
	 * @param {string} serial_number Serial number of the device
	 * @param {Panel} screen Screen object consisting of key indices and button objects
	 * @returns {Promise&lt;"DeviceNotFound"|"Reset">} Result of the operation
	 */
	reset_stack(serial_number, screen) {
		return this.protocol.request(
			{
				ty: "reset_stack",
				data: {
					serial_number,
					screen
				}
			}
		)
	}

	/**
	 * Resets stack and pushes a screen
	 * @param {string} serial_number Serial number of the device
	 * @returns {Promise&lt;"DeviceNotFound"|"Dropped">} Result of the operation
	 */
	drop_stack_to_root(serial_number) {
		return this.protocol.request(
			{
				ty: "drop_stack_to_root",
				data: {
					serial_number
				}
			}
		)
	}

	/**
	 * Commits changes made with screen related functions to device config, so they can be saved by save_device_config. Must be either called after each change, or sequence of changes
	 * @param {serial} serial_number 
	 * @returns {Promise&lt;"DeviceNotFound"|"Committed">} Result of the operation
	 */
	commit_changes(serial_number) {
		return this.protocol.request(
			{
				ty: "commit_changes",
				data: {
					serial_number
				}
			}
		)
	}

	/**
	 * Simulates a key press on the device
	 * @param {string} serial_number Serial number of the device
	 * @param {number|string} key Index of the key (0-255)
	 * @returns {Promise&lt;"DeviceNotFound"|"Activated">} Result of the operation
	 */
	do_button_action(serial_number, key) {
		return this.protocol.request(
			{
				ty: "do_button_action",
				data: {
					serial_number,
					key: parseInt(key)
				}
			}
		)
	}

	/**
	 * Destroys the client
	 */
	destroy() {
		this.protocol.destroy();
	}
}

function buildRequestProtocol(opts) {
	let protocol = {
		pool: {},
		event_listeners: []
	};

	/**
	 * Sends request to daemon
	 * @param data Data to send
	 * @param {number} [timeout] Timeout, defaults to options
	 * @returns {Promise&lt;Object>} Response
	 */
	protocol.request = (data, timeout) => {
		let requester = randomstring.generate();
		data.requester = requester;

		if (opts.client) {
			opts.client.write(JSON.stringify(data) + "\u0004");

			return new Promise((resolve, reject) => {
				let timer = setTimeout(() => {
					reject("Request timed out")
				}, timeout || opts.timeout)

				protocol.pool[requester] = function (data) {
					clearTimeout(timer);
					resolve(data)
				};
			})
		} else {
			return new Promise((_, reject) => reject("Client not connected"));
		}
	}

	protocol.add_event_listener = (func) => {
		protocol.event_listeners.push(func);
	}

	protocol.connected = () => {
		if (opts.client != null) {
			return opts.client.readyState === "open";
		} else {
			return false;
		}
	}

	protocol.destroy = () => {
		opts.destroy();
	}

	return protocol;
}

/**
 * Initializes a new Unix Domain Socket based Streamduck client
 * @param {{timeout: number?, reconnect: boolean?}?} opts Options for client. timeout - Request timeout, default 5000; reconnect - Automatically reconnects to daemon, default true
 * @returns {StreamduckClient} Client that might still be connecting, check with is_connected method
 */
exports.newUnixClient = function (opts) {
	let timeout = opts &amp;&amp; opts.timeout !== undefined ? opts.timeout : 5000;
	let reconnect = opts &amp;&amp; opts.reconnect !== undefined ? opts.reconnect : true;

	let protocol_options = {
		collected_string: "",
		client: null,
		timeout: timeout
	};

	let protocol = buildRequestProtocol(protocol_options);
	let streamduck = new StreamduckClient(protocol);

	let rec = () => {
		protocol_options.client = net.createConnection("/tmp/streamduck.sock")
			.on('connect', async () => {
				let version = await streamduck.version();

				let client_version = "0.2";
				if (version !== client_version)
					console.log(`Daemon version doesn't match this client's version. Daemon is using ${version}, client is using ${client_version}`);

				console.log("Connected to Streamduck");
			})
			.on('data', data => {
				data = data.toString();
				protocol_options.collected_string += data;

				if (protocol_options.collected_string.includes("\u0004")) {
					protocol_options.collected_string.split("\u0004").forEach(json => {
						if (json) {
							try {
								let obj = JSON.parse(json);

								if (obj.ty === "event") {
									for(const listener of protocol.event_listeners) {
										listener(obj.data)
									}
								} else {
									let callback = protocol.pool[obj.requester];

									if (callback) {
										callback(obj.data);
									}

									delete protocol.pool[obj.requester];
								}
							} catch (e) {

							}
						}
					});

					protocol_options.collected_string = "";
				}
			})
			.on('error', _ => {
				if (protocol_options.client) {
					protocol_options.client.destroy()
				}
				protocol_options.client = null;
			})
			.on('close', _ => {
				if (protocol_options.client) {
					protocol_options.client.destroy()
				}
				protocol_options.client = null;
			});
	}

	rec();
	setInterval(() => {
		if (protocol_options.client == null &amp;&amp; reconnect) {
			rec();
		}
	}, 2000);

	return streamduck;
}

/**
 * Initializes a new Windows Named Pipes based Streamduck client
 * @param {{timeout: number?, reconnect: boolean?, events: boolean?}?} opts Options for client. timeout - Request timeout, default 5000; reconnect - Automatically reconnects to daemon, default true
 * @returns {StreamduckClient} Client that might still be connecting, check with is_connected method
 */
exports.newWindowsClient = function (opts) {
	let timeout = opts &amp;&amp; opts.timeout !== undefined ? opts.timeout : 5000;
	let reconnect = opts &amp;&amp; opts.reconnect !== undefined ? opts.reconnect : true;

	let protocol_options = {
		collected_string_request: "",
		collected_string_event: "",
		client: null,
		eventClient: null,
		timeout: timeout
	}

	let protocol = buildRequestProtocol(protocol_options);
	let streamduck = new StreamduckClient(protocol);

	let rec = () => {
		protocol_options.client = net.connect("\\\\.\\pipe\\streamduck", async () => {
			let version = await streamduck.version();

			let client_version = "0.2";
			if (version !== client_version)
				console.log(`Daemon version doesn't match this client's version. Daemon is using ${version}, client is using ${client_version}`);

			console.log("Connected to Streamduck");
		})
			.on('data', data => {
				data = data.toString();
				protocol_options.collected_string_request += data;

				if (protocol_options.collected_string_request.includes("\u0004")) {
					protocol_options.collected_string_request.split("\u0004").forEach(json => {
						if (json) {
							try {
								let obj = JSON.parse(json);

								if (obj.ty === "event") {
									for(const listener of protocol.event_listeners) {
										listener(obj.data)
									}
								} else {
									let callback = protocol.pool[obj.requester];

									if (callback) {
										callback(obj.data);
									}

									delete protocol.pool[obj.requester];
								}
							} catch (e) {

							}
						}
					});

					protocol_options.collected_string_request = "";
				}
			})
			.on('error', _ => {
				if (protocol_options.client) {
					protocol_options.client.destroy()
				}
				protocol_options.client = null;
			})
			.on('close', _ => {
				if (protocol_options.client) {
					protocol_options.client.destroy()
				}
				protocol_options.client = null;
			});
	}

	rec();
	setInterval(() => {
		if (protocol_options.client == null &amp;&amp; reconnect) {
			rec();
		}
	}, 2000);

	return streamduck;
}</code></pre>
  </article>
</section>

    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>
